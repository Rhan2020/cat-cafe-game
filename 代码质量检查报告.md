# çŒ«å’ªå’–å•¡é¦†é¡¹ç›®ä»£ç è´¨é‡æ£€æŸ¥æŠ¥å‘Š

**æ—¥æœŸï¼š** 2024å¹´12æœˆ29æ—¥  
**ç‰ˆæœ¬ï¼š** v1.0  
**æ£€æŸ¥èŒƒå›´ï¼š** å…¨é¡¹ç›®ä»£ç è´¨é‡ã€æ¶æ„è®¾è®¡ã€æµ‹è¯•è¦†ç›–ã€æœ€ä½³å®è·µ

---

## ğŸ“Š æ€»ä½“è¯„ä¼°

### âœ… å·²æ»¡è¶³çš„è¦æ±‚
1. **è·¨å¹³å°æ¶æ„è®¾è®¡** - ä½¿ç”¨Cocos Creatoræ”¯æŒå¤šç«¯å‘å¸ƒ
2. **å¾®ä¿¡ç”Ÿæ€ä¼˜å…ˆ** - å®ç°äº†å®Œæ•´çš„å¾®ä¿¡äº‘å‡½æ•°ç³»ç»Ÿ
3. **åŒæœåŠ¡å™¨æ¶æ„** - å¾®ä¿¡æœåŠ¡å™¨(server_wechat)å’Œå…¨çƒæœåŠ¡å™¨(server_global)
4. **ç®¡ç†åå°** - Reactåº”ç”¨ï¼Œæ”¯æŒç”¨æˆ·ç›‘æ§å’Œé…ç½®ç®¡ç†
5. **åŸºç¡€æµ‹è¯•ç”¨ä¾‹** - å„æ¨¡å—éƒ½æœ‰æµ‹è¯•æ–‡ä»¶
6. **æ•°æ®åº“è®¾è®¡** - å®Œæ•´çš„æ•°æ®åº“æ¶æ„æ–‡æ¡£

### âŒ éœ€è¦æ”¹è¿›çš„å…³é”®é—®é¢˜
1. **ç¼ºå°‘CICDè‡ªåŠ¨åŒ–éƒ¨ç½²**
2. **ç¼ºå°‘å¼‚å¸¸ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ**
3. **æµ‹è¯•è¦†ç›–ä¸å¤Ÿå…¨é¢**
4. **ç¼ºå°‘æ€§èƒ½ä¼˜åŒ–å’Œé«˜å¹¶å‘æ”¯æŒ**
5. **ç¼ºå°‘å›½é™…åŒ–(i18n)å®ç°**
6. **ç¼ºå°‘å®‰å…¨é˜²æŠ¤æªæ–½**

---

## ğŸ— æ¶æ„è¯„ä¼°

### ä¼˜ç‚¹
- âœ… æ¨¡å—åŒ–æ¸…æ™°ï¼šå››ä¸ªç‹¬ç«‹æ¨¡å—åˆ†å·¥æ˜ç¡®
- âœ… æŠ€æœ¯é€‰å‹åˆç†ï¼šå¾®ä¿¡äº‘å‡½æ•° + Cocos Creator + React
- âœ… æ•°æ®åº“è®¾è®¡å®Œæ•´ï¼šç”¨æˆ·ã€åŠ¨ç‰©ã€é…ç½®ä¸‰å¤§æ ¸å¿ƒé›†åˆ

### é—®é¢˜
- âŒ ç¼ºå°‘å¾®æœåŠ¡é—´é€šä¿¡åè®®å®šä¹‰
- âŒ ç¼ºå°‘APIç½‘å…³å’Œè´Ÿè½½å‡è¡¡é…ç½®
- âŒ ç¼ºå°‘ç¼“å­˜ç­–ç•¥(Redis)
- âŒ ç¼ºå°‘æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ

---

## ğŸ§ª æµ‹è¯•è´¨é‡è¯„ä¼°

### ç°çŠ¶
- âœ… å¾®ä¿¡äº‘å‡½æ•°ï¼šåŸºç¡€æµ‹è¯•è¦†ç›–
- âœ… å…¨çƒæœåŠ¡å™¨ï¼šé›†æˆæµ‹è¯•å®ç°
- âŒ å®¢æˆ·ç«¯ï¼šæ— æµ‹è¯•ç”¨ä¾‹
- âŒ ç®¡ç†åå°ï¼šæ— æµ‹è¯•ç”¨ä¾‹

### é—®é¢˜
- æµ‹è¯•è¦†ç›–ç‡ä¸è¶³50%
- ç¼ºå°‘ç«¯åˆ°ç«¯(E2E)æµ‹è¯•
- ç¼ºå°‘æ€§èƒ½æµ‹è¯•
- ç¼ºå°‘å‹åŠ›æµ‹è¯•

---

## ğŸ”’ å®‰å…¨æ€§è¯„ä¼°

### ä¸¥é‡é—®é¢˜
- âŒ æ— è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
- âŒ æ— è®¿é—®æ§åˆ¶å’Œæƒé™ç®¡ç†
- âŒ æ— æ•°æ®åŠ å¯†
- âŒ æ— APIé™æµé˜²æŠ¤
- âŒ æ— SQLæ³¨å…¥é˜²æŠ¤

---

## ğŸ“ˆ æ€§èƒ½å’Œå¹¶å‘è¯„ä¼°

### é—®é¢˜
- âŒ æ— æ•°æ®åº“è¿æ¥æ± é…ç½®
- âŒ æ— ç¼“å­˜æœºåˆ¶
- âŒ æ— CDNé…ç½®
- âŒ æ— è´Ÿè½½å‡è¡¡
- âŒ æ— æ€§èƒ½ç›‘æ§

---

## ğŸŒ å›½é™…åŒ–è¯„ä¼°

### é—®é¢˜
- âŒ ä»£ç ä¸­å¤§é‡ä¸­æ–‡ç¡¬ç¼–ç 
- âŒ æ— å¤šè¯­è¨€æ–‡ä»¶ç®¡ç†
- âŒ æ— è¯­è¨€åˆ‡æ¢æœºåˆ¶
- âŒ æ— æ—¶åŒºå¤„ç†

---

## ğŸ“ ä»£ç è´¨é‡è¯¦ç»†åˆ†æ

### å¾®ä¿¡äº‘å‡½æ•° (server_wechat)
**ä¼˜ç‚¹ï¼š**
- å‡½æ•°ç»“æ„æ¸…æ™°ï¼ŒèŒè´£å•ä¸€
- é”™è¯¯å¤„ç†ç›¸å¯¹å®Œæ•´
- æœ‰åŸºç¡€æµ‹è¯•è¦†ç›–

**é—®é¢˜ï¼š**
- ç¼ºå°‘è¾“å…¥å‚æ•°éªŒè¯
- ç¼ºå°‘è¯¦ç»†çš„æ—¥å¿—è®°å½•
- ç¼ºå°‘æ€§èƒ½ç›‘æ§
- ç¼ºå°‘å¼‚å¸¸å‘Šè­¦

### å…¨çƒæœåŠ¡å™¨ (server_global)
**ä¼˜ç‚¹ï¼š**
- ä½¿ç”¨Expressæ¡†æ¶ï¼Œç»“æ„æ ‡å‡†
- æœ‰å®Œæ•´çš„æ¨¡å‹å®šä¹‰
- æœ‰é›†æˆæµ‹è¯•

**é—®é¢˜ï¼š**
- ç¼ºå°‘ä¸­é—´ä»¶é…ç½®(CORSã€å®‰å…¨å¤´ã€é™æµ)
- ç¼ºå°‘ç¯å¢ƒé…ç½®ç®¡ç†
- ç¼ºå°‘å¥åº·æ£€æŸ¥ç«¯ç‚¹
- ç¼ºå°‘Dockerå®¹å™¨åŒ–

### å®¢æˆ·ç«¯ (client)
**ä¼˜ç‚¹ï¼š**
- ç½‘ç»œç®¡ç†å™¨è®¾è®¡åˆç†
- æ¸¸æˆç®¡ç†å™¨èŒè´£æ¸…æ™°

**é—®é¢˜ï¼š**
- ç¼ºå°‘é”™è¯¯å¤„ç†UI
- ç¼ºå°‘ç¦»çº¿åŠŸèƒ½
- ç¼ºå°‘æ€§èƒ½ä¼˜åŒ–
- å®Œå…¨æ— æµ‹è¯•ç”¨ä¾‹

### ç®¡ç†åå° (admin_backend)
**ä¼˜ç‚¹ï¼š**
- ä½¿ç”¨Antdç»„ä»¶åº“ï¼ŒUIç°ä»£åŒ–
- é…ç½®ç¼–è¾‘åŠŸèƒ½å®Œæ•´

**é—®é¢˜ï¼š**
- ç¼ºå°‘ç”¨æˆ·è®¤è¯
- ç¼ºå°‘æƒé™æ§åˆ¶
- ç¼ºå°‘æ•°æ®éªŒè¯
- ç¼ºå°‘é”™è¯¯è¾¹ç•Œ

---

## ğŸš€ ç«‹å³éœ€è¦ä¿®å¤çš„å…³é”®é—®é¢˜

### 1. å®‰å…¨æ¼æ´
```javascript
// é—®é¢˜ï¼šæ— è¾“å…¥éªŒè¯
exports.main = async (event, context) => {
  // ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥ï¼Œå­˜åœ¨å®‰å…¨é£é™©
  const { nickname } = event;
  
  // ä¿®å¤ï¼šæ·»åŠ è¾“å…¥éªŒè¯
  if (!nickname || typeof nickname !== 'string' || nickname.length > 50) {
    return { code: 400, message: 'Invalid nickname' };
  }
}
```

### 2. é”™è¯¯å¤„ç†ä¸å®Œæ•´
```javascript
// é—®é¢˜ï¼šé”™è¯¯ä¿¡æ¯æš´éœ²è¿‡å¤š
catch (err) {
  console.error('Error:', err);
  return { code: 500, message: 'Internal Server Error', error: err }; // ä¸åº”è¯¥æš´éœ²é”™è¯¯è¯¦æƒ…
}

// ä¿®å¤ï¼šè§„èŒƒé”™è¯¯å¤„ç†
catch (err) {
  console.error('Error:', err);
  return { code: 500, message: 'Internal Server Error' };
}
```

### 3. ç¼ºå°‘ç¯å¢ƒé…ç½®
```javascript
// é—®é¢˜ï¼šç¡¬ç¼–ç é…ç½®
const dbURI = 'mongodb://localhost:27017/game';

// ä¿®å¤ï¼šç¯å¢ƒå˜é‡é…ç½®
const dbURI = process.env.MONGODB_URI || 'mongodb://localhost:27017/game';
```

---

## ğŸ“‹ æ”¹è¿›è®¡åˆ’å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šå®‰å…¨å’Œç¨³å®šæ€§ (2å‘¨)
1. **æ·»åŠ è¾“å…¥éªŒè¯å’Œè¿‡æ»¤**
2. **å®ç°ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶**
3. **æ·»åŠ APIé™æµå’Œé˜²æŠ¤**
4. **å®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ**
5. **æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹**

### ç¬¬äºŒé˜¶æ®µï¼šæµ‹è¯•å’Œè´¨é‡ (2å‘¨)
1. **æå‡æµ‹è¯•è¦†ç›–ç‡åˆ°80%+**
2. **æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•**
3. **å®ç°æ€§èƒ½æµ‹è¯•**
4. **æ·»åŠ ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·**

### ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½å’Œå¹¶å‘ (3å‘¨)
1. **å®ç°Redisç¼“å­˜**
2. **é…ç½®æ•°æ®åº“è¿æ¥æ± **
3. **æ·»åŠ è´Ÿè½½å‡è¡¡**
4. **å®ç°CDNé…ç½®**
5. **æ€§èƒ½ç›‘æ§ç³»ç»Ÿ**

### ç¬¬å››é˜¶æ®µï¼šå›½é™…åŒ–å’Œéƒ¨ç½² (2å‘¨)
1. **å®ç°å¤šè¯­è¨€æ”¯æŒ**
2. **CICDè‡ªåŠ¨åŒ–éƒ¨ç½²**
3. **Dockerå®¹å™¨åŒ–**
4. **ç›‘æ§å‘Šè­¦ç³»ç»Ÿ**

---

## ğŸ¯ å…·ä½“ä»£ç æ”¹è¿›å»ºè®®

### 1. ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
```javascript
// åˆ›å»º server_global/middleware/errorHandler.js
const errorHandler = (err, req, res, next) => {
  console.error(err.stack);
  
  if (err.name === 'ValidationError') {
    return res.status(400).json({ message: 'Validation Error' });
  }
  
  res.status(500).json({ message: 'Internal Server Error' });
};

module.exports = errorHandler;
```

### 2. æ·»åŠ è¾“å…¥éªŒè¯ä¸­é—´ä»¶
```javascript
// åˆ›å»º server_global/middleware/validation.js
const { body, validationResult } = require('express-validator');

const validateLogin = [
  body('authProviderId').isLength({ min: 1 }).trim().escape(),
  body('nickname').isLength({ min: 1, max: 50 }).trim().escape(),
  (req, res, next) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({ errors: errors.array() });
    }
    next();
  }
];

module.exports = { validateLogin };
```

### 3. å®ç°é…ç½®ç®¡ç†
```javascript
// åˆ›å»º config/index.js
const config = {
  development: {
    mongodb: {
      uri: process.env.MONGODB_URI || 'mongodb://localhost:27017/game_dev',
      options: { maxPoolSize: 10 }
    },
    redis: {
      host: process.env.REDIS_HOST || 'localhost',
      port: process.env.REDIS_PORT || 6379
    }
  },
  production: {
    mongodb: {
      uri: process.env.MONGODB_URI,
      options: { maxPoolSize: 50 }
    },
    redis: {
      host: process.env.REDIS_HOST,
      port: process.env.REDIS_PORT
    }
  }
};

module.exports = config[process.env.NODE_ENV || 'development'];
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| æ¨¡å— | å½“å‰è¦†ç›–ç‡ | ç›®æ ‡è¦†ç›–ç‡ | ä¼˜å…ˆçº§ |
|------|------------|------------|---------|
| server_wechat | 30% | 85% | é«˜ |
| server_global | 25% | 85% | é«˜ |
| admin_backend | 0% | 70% | ä¸­ |
| client | 0% | 60% | ä¸­ |

---

## ğŸ”§ æ¨èå·¥å…·å’ŒæŠ€æœ¯æ ˆè¡¥å……

### å¼€å‘å·¥å…·
- **ESLint + Prettier** - ä»£ç è§„èŒƒ
- **Husky + lint-staged** - Git hooks
- **SonarQube** - ä»£ç è´¨é‡æ£€æŸ¥
- **Jest + Coverage** - æµ‹è¯•è¦†ç›–ç‡

### ç›‘æ§å’Œæ—¥å¿—
- **Winston** - æ—¥å¿—ç®¡ç†
- **Prometheus + Grafana** - æ€§èƒ½ç›‘æ§
- **Sentry** - é”™è¯¯ç›‘æ§
- **New Relic** - APMç›‘æ§

### éƒ¨ç½²å’Œè¿ç»´
- **Docker + Docker Compose** - å®¹å™¨åŒ–
- **GitHub Actions** - CICD
- **Nginx** - åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
- **Redis** - ç¼“å­˜å’Œä¼šè¯ç®¡ç†

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ç›®æ ‡ |
|------|----------|------|
| APIå“åº”æ—¶é—´ | æœªçŸ¥ | <200ms |
| æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ | æœªçŸ¥ | <50ms |
| å®¢æˆ·ç«¯å¯åŠ¨æ—¶é—´ | æœªçŸ¥ | <3s |
| å¹¶å‘ç”¨æˆ·æ•° | æœªçŸ¥ | 10000+ |
| å¯ç”¨æ€§ | æœªçŸ¥ | 99.9% |

---

## ğŸ“‹ æ€»ç»“å’Œå»ºè®®

### å½“å‰é¡¹ç›®ä¼˜åŠ¿
1. æ¶æ„è®¾è®¡åˆç†ï¼Œç¬¦åˆè·¨å¹³å°è¦æ±‚
2. æŠ€æœ¯é€‰å‹ç¬¦åˆå¾®ä¿¡ç”Ÿæ€ä¼˜å…ˆçš„ç­–ç•¥
3. åŸºç¡€åŠŸèƒ½å®ç°å®Œæ•´
4. ç®¡ç†åå°åŠŸèƒ½é½å…¨

### ä¸»è¦é£é™©
1. **å®‰å…¨é£é™©é«˜** - ç¼ºå°‘åŸºæœ¬çš„å®‰å…¨é˜²æŠ¤
2. **ç¨³å®šæ€§é£é™©** - é”™è¯¯å¤„ç†ä¸å®Œå–„
3. **æ€§èƒ½é£é™©** - æ— å¹¶å‘å¤„ç†ä¼˜åŒ–
4. **ç»´æŠ¤é£é™©** - æµ‹è¯•è¦†ç›–ä¸è¶³

### ä¸‹ä¸€æ­¥å»ºè®®
1. **ç«‹å³ä¿®å¤å®‰å…¨æ¼æ´** - æœ€é«˜ä¼˜å…ˆçº§
2. **å®Œå–„æµ‹è¯•ä½“ç³»** - ç¡®ä¿ä»£ç è´¨é‡
3. **å®ç°CICDæµç¨‹** - æå‡å¼€å‘æ•ˆç‡
4. **æ·»åŠ ç›‘æ§å‘Šè­¦** - ç¡®ä¿ç”Ÿäº§ç¨³å®š

---

**æ£€æŸ¥å®Œæˆæ—¶é—´ï¼š** 2024å¹´12æœˆ29æ—¥  
**æ£€æŸ¥äººå‘˜ï¼š** AI Assistant  
**ä¸‹æ¬¡æ£€æŸ¥å»ºè®®ï¼š** 2å‘¨åè¿›è¡Œç¬¬äºŒè½®æ£€æŸ¥